# 數位音樂廳專案修復指南

本文檔說明了對數位音樂廳專案進行的修復和改進。

## 修復的問題

1. **API URL 配置不一致**
   - frontend-client 環境變量設為 http://localhost:8081，但後端運行在 8080 端口
   - 修正了 .env.development 中的配置

2. **API 路徑處理不一致**
   - 改進了 apiUtils.js 中的路徑處理邏輯
   - 增強了調試日誌

3. **缺乏調試工具**
   - 添加了 API 測試工具
   - 創建了專用的調試頁面

## 修復腳本

我們提供了以下腳本來解決這些問題：

### 1. `fix-api-config.sh`
修復 API URL 配置問題，確保所有前端項目使用正確的後端地址。

### 2. `update-utils.sh`
更新 API 工具函數，增強調試功能，並添加 API 測試工具。

### 3. `setup-debug.sh`
設置調試環境，為所有腳本添加執行權限，並運行上述兩個腳本。

### 4. `run-all-fixes.sh`
綜合修復腳本，執行所有修復步驟並啟動應用程序。

## 使用方法

1. 給腳本添加執行權限：
   ```bash
   chmod +x run-all-fixes.sh
   ```

2. 執行綜合修復腳本：
   ```bash
   ./run-all-fixes.sh
   ```

3. 訪問調試工具：
   - 用戶前台：http://localhost:3000/debug/api-test
   - 管理員後台：http://localhost:3001/debug/api-test

## 調試 API 連接問題

當您遇到 API 連接問題時，可以使用調試工具進行以下檢查：

1. **環境變量檢查**：
   - 確認 REACT_APP_API_URL 是否設置正確
   - 應為 http://localhost:8080

2. **API 路徑檢查**：
   - 所有 API 請求路徑必須以 `/api/` 開頭
   - 工具會自動檢測和修正不正確的路徑

3. **請求測試**：
   - 測試與後端的基本連接
   - 檢查後端服務是否正常運行

4. **認證狀態檢查**：
   - 驗證當前用戶的認證狀態
   - 確保令牌正確存儲和使用

## 常見問題解決

### 1. 後端連接失敗
- 檢查後端服務是否正在運行
- 確認端口是否為 8080
- 檢查防火牆是否允許該端口的連接

### 2. API 路徑 404 錯誤
- 確保使用了 `validateApiPath` 函數
- 檢查前綴是否為 `/api/`
- 對於管理員接口，路徑應為 `/api/admin/...`

### 3. 認證問題
- 檢查令牌是否正確存儲在 localStorage
- 確保 axios 請求攔截器正確附加了認證頭信息
- 確認後端認證配置是否正確

### 4. CORS 錯誤
- 確認後端是否開啟了 CORS 支持
- 檢查允許的源是否包括前端應用的地址
- 前端應用應運行在端口 3000 (用戶前台) 和 3001 (管理員後台)

## 其他注意事項

- 調試工具會在控制台輸出詳細的請求和響應信息，請查看瀏覽器開發者工具的控制台
- 請確保在開發環境中使用這些工具，不要將其部署到生產環境
- 修復腳本已經調整了代理設置，不需要手動修改 package.json
