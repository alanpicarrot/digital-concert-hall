# æ•¸ä½éŸ³æ¨‚å»³å¾Œç«¯å®Œæ•´æ—¥èªŒç³»çµ±

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»çµ±æä¾›äº†å®Œæ•´çš„æ—¥èªŒè¨˜éŒ„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- è‡ªå‹•å•Ÿå‹•æ™‚é–“å‘½åçš„æ—¥èªŒæª”æ¡ˆ
- ç³»çµ±è³‡æºç›£æ§
- HTTPè«‹æ±‚è¿½è¹¤
- è©³ç´°çš„æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ
- ä¾¿æ·çš„æ—¥èªŒç®¡ç†å·¥å…·

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. è¨­ç½®æ¬Šé™
```bash
cd /Users/alanp/digital-concert-hall/backend
chmod +x set-permissions.sh
./set-permissions.sh
```

### 2. å•Ÿå‹•æœå‹™ï¼ˆå¸¶å®Œæ•´æ—¥èªŒè¨˜éŒ„ï¼‰
```bash
# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
./scripts/start-with-logging.sh dev

# å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ  
./scripts/start-with-logging.sh prod

# å•Ÿå‹•æ¸¬è©¦ç’°å¢ƒ
./scripts/start-with-logging.sh test
```

### 3. æŸ¥çœ‹æ—¥èªŒ
```bash
# æŸ¥çœ‹æœ€æ–°å•Ÿå‹•æ—¥èªŒ
./scripts/log-manager.sh latest

# å³æ™‚ç›£æ§æ—¥èªŒ
./scripts/log-manager.sh tail

# åˆ—å‡ºæ‰€æœ‰æ—¥èªŒæª”æ¡ˆ
./scripts/log-manager.sh list
```

### 4. åœæ­¢æœå‹™
```bash
./scripts/stop-service.sh
```

## ğŸ“ æ—¥èªŒçµæ§‹

```
logs/
â”œâ”€â”€ startup/                          # å•Ÿå‹•ç›¸é—œæ—¥èªŒ
â”‚   â”œâ”€â”€ backend_startup_20241201_143022.log  # å•Ÿå‹•æ™‚é–“å‘½åçš„æ—¥èªŒ
â”‚   â”œâ”€â”€ startup_success_20241201_143045.marker
â”‚   â””â”€â”€ shutdown_20241201_150022.marker
â”œâ”€â”€ backend.log                       # ä¸»è¦æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ
â”œâ”€â”€ api.log                          # APIè«‹æ±‚æ—¥èªŒ
â”œâ”€â”€ security.log                     # å®‰å…¨ç›¸é—œæ—¥èªŒ
â”œâ”€â”€ performance.log                  # æ•ˆèƒ½ç›£æ§æ—¥èªŒ
â”œâ”€â”€ error.log                        # éŒ¯èª¤æ—¥èªŒ
â”œâ”€â”€ test.log                         # æ¸¬è©¦æ—¥èªŒ
â””â”€â”€ archived/                        # å°å­˜çš„æ—¥èªŒæª”æ¡ˆ
    â”œâ”€â”€ backend.2024-12-01.0.log.gz
    â””â”€â”€ ...
```

## ğŸ”§ æ—¥èªŒç®¡ç†å·¥å…·

### `log-manager.sh` å‘½ä»¤

| å‘½ä»¤ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `list` | åˆ—å‡ºæ‰€æœ‰æ—¥èªŒæª”æ¡ˆ | `./scripts/log-manager.sh list` |
| `latest` | æŸ¥çœ‹æœ€æ–°çš„å•Ÿå‹•æ—¥èªŒ | `./scripts/log-manager.sh latest` |
| `tail [æª”å]` | å³æ™‚ç›£æ§æ—¥èªŒæª”æ¡ˆ | `./scripts/log-manager.sh tail` |
| `view [æª”å]` | æŸ¥çœ‹å®Œæ•´æ—¥èªŒæª”æ¡ˆ | `./scripts/log-manager.sh view backend.log` |
| `search [é—œéµå­—]` | åœ¨æ‰€æœ‰æ—¥èªŒä¸­æœå°‹ | `./scripts/log-manager.sh search "ERROR"` |
| `errors` | æŸ¥çœ‹æ‰€æœ‰éŒ¯èª¤æ—¥èªŒ | `./scripts/log-manager.sh errors` |
| `clean [å¤©æ•¸]` | æ¸…ç†èˆŠæ—¥èªŒæª”æ¡ˆ | `./scripts/log-manager.sh clean 30` |
| `status` | é¡¯ç¤ºæ—¥èªŒçµ±è¨ˆè³‡è¨Š | `./scripts/log-manager.sh status` |
| `archive [å¤©æ•¸]` | å°å­˜èˆŠæ—¥èªŒæª”æ¡ˆ | `./scripts/log-manager.sh archive 7` |

## ğŸ¯ æ—¥èªŒåŠŸèƒ½ç‰¹é»

### 1. å•Ÿå‹•æ™‚é–“å‘½å
- æ¯æ¬¡å•Ÿå‹•æœå‹™éƒ½æœƒå‰µå»ºä»¥å•Ÿå‹•æ™‚é–“å‘½åçš„æ—¥èªŒæª”æ¡ˆ
- æ ¼å¼ï¼š`backend_startup_YYYYMMDD_HHMMSS.log`
- è‡ªå‹•è¨˜éŒ„å•Ÿå‹•å’Œé—œé–‰æ™‚é–“

### 2. ç³»çµ±ç›£æ§
- æ¯5åˆ†é˜è¨˜éŒ„ç³»çµ±è³‡æºä½¿ç”¨æƒ…æ³
- æ¯å°æ™‚ç”Ÿæˆè©³ç´°å¥åº·å ±å‘Š
- ç›£æ§é …ç›®ï¼šè¨˜æ†¶é«”ã€CPUã€ç£ç¢Ÿç©ºé–“ã€ç·šç¨‹ã€åƒåœ¾å›æ”¶

### 3. HTTPè«‹æ±‚è¿½è¹¤
- æ¯å€‹è«‹æ±‚è‡ªå‹•åˆ†é…è¿½è¹¤ID
- è¨˜éŒ„è«‹æ±‚å’ŒéŸ¿æ‡‰çš„è©³ç´°è³‡è¨Š
- è‡ªå‹•è¨ˆç®—è™•ç†æ™‚é–“
- æ ¹æ“šç‹€æ…‹ç¢¼å’Œè™•ç†æ™‚é–“èª¿æ•´æ—¥èªŒç´šåˆ¥

### 4. åˆ†é¡æ—¥èªŒ
- **æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ** (`backend.log`): ä¸»è¦æ¥­å‹™é‚è¼¯
- **APIæ—¥èªŒ** (`api.log`): HTTPè«‹æ±‚éŸ¿æ‡‰
- **å®‰å…¨æ—¥èªŒ** (`security.log`): èªè­‰æˆæ¬Šç›¸é—œ
- **æ•ˆèƒ½æ—¥èªŒ** (`performance.log`): ç³»çµ±ç›£æ§è³‡æ–™
- **éŒ¯èª¤æ—¥èªŒ** (`error.log`): æ‰€æœ‰éŒ¯èª¤è¨Šæ¯
- **æ¸¬è©¦æ—¥èªŒ** (`test.log`): æ¸¬è©¦ç›¸é—œ

### 5. è‡ªå‹•è¼ªè½‰å’Œå°å­˜
- æ—¥èªŒæª”æ¡ˆå¤§å°é”åˆ°é™åˆ¶æ™‚è‡ªå‹•è¼ªè½‰
- è‡ªå‹•å£“ç¸®èˆŠæ—¥èªŒæª”æ¡ˆ
- å¯é…ç½®ä¿ç•™å¤©æ•¸å’Œç¸½å¤§å°é™åˆ¶

## âš™ï¸ é…ç½®èªªæ˜

### æ—¥èªŒé…ç½®æª”æ¡ˆ
- ä¸»é…ç½®ï¼š`src/main/resources/logback-spring-enhanced.xml`
- æ‡‰ç”¨é…ç½®ï¼š`src/main/resources/application.properties`

### ç’°å¢ƒç‰¹å®šé…ç½®
- **é–‹ç™¼ç’°å¢ƒ** (`dev`): DEBUGç´šåˆ¥ï¼Œè©³ç´°SQLæ—¥èªŒ
- **æ¸¬è©¦ç’°å¢ƒ** (`test`): DEBUGç´šåˆ¥ï¼Œæ¸¬è©¦å°ˆç”¨æ—¥èªŒ
- **ç”Ÿç”¢ç’°å¢ƒ** (`prod`): INFOç´šåˆ¥ï¼Œå„ªåŒ–æ•ˆèƒ½

## ğŸ” å¸¸ç”¨æ—¥èªŒæŸ¥çœ‹å‘½ä»¤

### æŸ¥çœ‹æœ€æ–°æ—¥èªŒ
```bash
# æŸ¥çœ‹æœ€æ–°å•Ÿå‹•æ—¥èªŒ
./scripts/log-manager.sh latest

# å³æ™‚ç›£æ§æœ€æ–°æ—¥èªŒ
./scripts/log-manager.sh tail

# æŸ¥çœ‹ç‰¹å®šæ—¥èªŒæª”æ¡ˆ
./scripts/log-manager.sh view backend_startup_20241201_143022.log
```

### æœå°‹å’Œéæ¿¾
```bash
# æœå°‹éŒ¯èª¤è¨Šæ¯
./scripts/log-manager.sh search "ERROR"

# æœå°‹ç‰¹å®šç”¨æˆ¶çš„æ“ä½œ
./scripts/log-manager.sh search "userId:123"

# æŸ¥çœ‹æ‰€æœ‰éŒ¯èª¤
./scripts/log-manager.sh errors
```

### æ¸…ç†å’Œç¶­è­·
```bash
# æŸ¥çœ‹æ—¥èªŒçµ±è¨ˆ
./scripts/log-manager.sh status

# æ¸…ç†30å¤©å‰çš„æ—¥èªŒ
./scripts/log-manager.sh clean 30

# å°å­˜7å¤©å‰çš„æ—¥èªŒ
./scripts/log-manager.sh archive 7
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. æ¬Šé™å•é¡Œ
```bash
# å¦‚æœè…³æœ¬ç„¡æ³•åŸ·è¡Œ
chmod +x ./scripts/*.sh
./set-permissions.sh
```

#### 2. æ—¥èªŒç›®éŒ„ä¸å­˜åœ¨
```bash
# æ‰‹å‹•å‰µå»ºæ—¥èªŒç›®éŒ„
mkdir -p logs/startup
mkdir -p logs/archived
```

#### 3. ç£ç¢Ÿç©ºé–“ä¸è¶³
```bash
# æª¢æŸ¥ç£ç¢Ÿä½¿ç”¨æƒ…æ³
./scripts/log-manager.sh status

# æ¸…ç†èˆŠæ—¥èªŒ
./scripts/log-manager.sh clean 7
```

#### 4. æœå‹™ç„¡æ³•åœæ­¢
```bash
# æª¢æŸ¥é€²ç¨‹
ps aux | grep digital-concert-hall

# å¼·åˆ¶åœæ­¢
kill -9 <PID>
```

## ğŸ“ˆ æœ€ä½³å¯¦è¸

### 1. æ—¥èªŒç´šåˆ¥ä½¿ç”¨
- **ERROR**: ç³»çµ±éŒ¯èª¤ã€ç•°å¸¸æƒ…æ³
- **WARN**: è­¦å‘Šã€æ½›åœ¨å•é¡Œ
- **INFO**: é‡è¦æ¥­å‹™æµç¨‹ã€ç‹€æ…‹è®Šæ›´
- **DEBUG**: é™¤éŒ¯è³‡è¨Šã€è©³ç´°æµç¨‹
- **TRACE**: æœ€è©³ç´°çš„è¿½è¹¤è³‡è¨Š

### 2. æ•ˆèƒ½è€ƒé‡
- ä½¿ç”¨ç•°æ­¥Appenderæå‡æ•ˆèƒ½
- é¿å…åœ¨è¿´åœˆä¸­è¨˜éŒ„DEBUGç´šåˆ¥æ—¥èªŒ
- åˆç†è¨­ç½®æ—¥èªŒè¼ªè½‰å’Œä¿ç•™ç­–ç•¥

### 3. å®‰å…¨æ€§
- é¿å…è¨˜éŒ„æ•æ„Ÿè³‡è¨Šï¼ˆå¯†ç¢¼ã€tokenï¼‰
- å°æ•æ„Ÿè³‡æ–™é€²è¡Œé®ç½©è™•ç†
- è¨­ç½®é©ç•¶çš„æ—¥èªŒæª”æ¡ˆæ¬Šé™

### 4. ç›£æ§å’Œè­¦å ±
- å®šæœŸæª¢æŸ¥æ—¥èªŒæª”æ¡ˆå¤§å°
- ç›£æ§éŒ¯èª¤æ—¥èªŒæ•¸é‡
- è¨­ç½®ç£ç¢Ÿç©ºé–“è­¦å ±

---

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°ï¼Œè«‹åƒè€ƒï¼š
1. æŸ¥çœ‹ `logs/startup/` ç›®éŒ„ä¸‹çš„æœ€æ–°å•Ÿå‹•æ—¥èªŒ
2. ä½¿ç”¨ `./scripts/log-manager.sh errors` æª¢æŸ¥éŒ¯èª¤
3. é‹è¡Œ `./scripts/log-manager.sh status` æŸ¥çœ‹ç³»çµ±ç‹€æ…‹

**è¨˜ä½**ï¼šè‰¯å¥½çš„æ—¥èªŒæ˜¯é™¤éŒ¯å’Œç›£æ§çš„æœ€ä½³æœ‹å‹ï¼ ğŸ¯
