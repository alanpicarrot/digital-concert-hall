# 數位音樂廳 - 身份驗證系統整合記錄

本文檔記錄了數位音樂廳專案中的身份驗證系統開發和前後端整合過程。

## 一、後端實作

### 1. 專案結構設計

建立了標準的Spring Boot專案結構：
- `controller`：處理HTTP請求和回應
- `model`：定義數據實體
- `repository`：負責數據持久層操作
- `service`：處理業務邏輯
- `config`：應用程序配置
- `security`：處理安全相關邏輯
- `exception`：自定義異常處理
- `dto`：數據傳輸對象，用於API請求和回應

### 2. 用戶身份驗證API

實現了以下API端點:
- POST `/api/auth/login` - 會員登入
- POST `/api/auth/register` - 會員註冊
- POST `/api/auth/logout` - 登出
- POST `/api/auth/forgot-password` - 忘記密碼
- POST `/api/auth/reset-password` - 重設密碼

### 3. 會員資訊API

實現了以下API端點:
- GET `/api/users/me` - 獲取當前登入會員資訊
- PUT `/api/users/me` - 更新會員資訊
- PUT `/api/users/me/password` - 更新密碼

### 4. JWT安全實現

使用JWT (JSON Web Token)實現無狀態身份驗證:
- 配置了JWT令牌生成和驗證
- 設定了令牌過期時間
- 實現了認證過濾器

### 5. 數據模型

創建了以下實體模型:
- `User`: 用戶實體，包含基本用戶資訊
- `Role`: 角色實體，定義不同的用戶角色
- `ERole`: 角色枚舉，定義了ROLE_USER, ROLE_MODERATOR, ROLE_ADMIN

## 二、前端整合

### 1. 認證服務

創建了AuthService.js服務類處理身份驗證功能:
- 登入/登出功能
- JWT令牌管理
- 用戶資料獲取與更新
- 密碼重置

### 2. 認證組件

開發了以下React組件:
- `Login.jsx`: 用戶登入頁面
- `Register.jsx`: 用戶註冊頁面
- `Profile.jsx`: 用戶資料管理頁面
- `ForgotPassword.jsx`: 忘記密碼頁面
- `ResetPassword.jsx`: 重設密碼頁面
- `ProtectedRoute.jsx`: 受保護路由組件

### 3. 用戶界面整合

- 在導航欄添加了`AuthNav.jsx`組件顯示用戶登入狀態
- 整合了登入/登出功能到主界面
- 實現了根據登入狀態動態顯示不同菜單選項

### 4. 跨域問題解決

- 配置了代理以解決開發環境中的跨域問題
- 使用Axios請求攔截器添加認證標頭

## 三、界面優化

針對發現的UI問題進行了以下優化:

### 1. 表單佈局優化
- 修改了表單容器樣式，使其更加協調
- 替換了全屏寬度的佈局為更合適的容器
- 為表單添加了背景色和陰影，使其更加突出

### 2. 輸入欄位改進
- 為輸入欄位添加了可見的標籤，而不是隱藏標籤
- 優化了輸入欄位的樣式，使用單獨的圓角而不是連續的形狀
- 增加了欄位之間的間距

### 3. 導航元素優化
- 修復了右上角用戶名稱顯示不清的問題
- 統一添加了音符圖示提升品牌一致性
- 優化了移動端選單，根據用戶登入狀態顯示適當選項

## 四、開發總結

### 已完成的工作
- 完整的後端身份驗證系統實作
- 與前端的無縫整合
- 用戶界面視覺優化和問題修復
- H2開發資料庫配置

### 下一步行動計劃
1. **資料庫遷移規劃**：從H2測試資料庫遷移到生產級MySQL/PostgreSQL資料庫
2. **核心業務功能開發**：音樂會管理、藝術家資料管理、票務系統等
3. **用戶體驗提升**：完善個人資料管理、實作更高級的權限控制
4. **系統安全加強**：添加更完善的API請求驗證、實作CSRF保護
5. **測試與部署**：編寫測試、設置CI/CD流程、準備生產環境部署

## 五、技術比較與知識點

### H2 vs MySQL 資料庫比較

| 特性 | H2 | MySQL |
|------|----|----|
| 設計目的 | 輕量級、嵌入式資料庫 | 企業級生產環境資料庫 |
| 部署模式 | 嵌入式、記憶體或伺服器模式 | 伺服器模式 |
| 適用場景 | 開發和測試環境 | 生產環境 |
| 性能 | 適合小型應用 | 可處理大量數據和高並發 |
| 功能 | 基本SQL和事務支援 | 完整的企業級功能 |

### JWT vs Session 身份驗證比較

JWT (使用中的方案):
- 無狀態，伺服器不需要保存會話數據
- 適合分布式系統和微服務架構
- 可以在客戶端存儲用戶信息
- 令牌過期需要重新登入

Session:
- 有狀態，伺服器需要保存會話數據
- 更容易實現登出和會話撤銷
- 安全性較高，敏感數據存儲在伺服器
- 需要處理會話共享和持久化

## 六、學習心得

在這個專案中，我們成功實現了一個完整的身份驗證系統，包括前後端的整合。通過使用Spring Security和JWT，我們創建了一個安全、可靠的認證機制，同時維持了良好的用戶體驗。

React前端與Spring Boot後端的整合雖然涉及一些複雜性，但通過良好的架構設計和適當的模式，我們實現了清晰的職責分離和易於維護的代碼結構。

前端UI的優化過程也提供了寶貴的經驗，展示了如何通過細節調整來大幅提升用戶體驗。

接下來，我們將繼續擴展系統，添加更多業務功能，並為生產環境部署做準備。

---

記錄日期: 2025年3月23日
