# 票券狀態顯示問題修復紀錄

## 問題描述

票券管理系統中，當票券被編輯並設置狀態為「上架中」時，UI中的狀態顯示沒有正確更新，仍然顯示為「未上架」。 

具體表現：
- 編輯票券時在模態框中設置狀態為「上架中」
- 按下「更新」按鈕後，表格中的狀態仍然顯示為「未上架」
- 需要再次編輯並提交才能使狀態更新顯示

## 根本原因分析

1. **狀態值標準化問題**：系統中對狀態值的處理不一致，有時使用空值作為默認值，導致狀態判斷邏輯混亂
2. **前後端同步問題**：API更新後，前端沒有立即更新本地狀態，而是等待重新加載，這可能導致延遲或不同步
3. **數據轉換問題**：從後端獲取的數據在前端展示前沒有正確標準化
4. **預設值不一致**：票券模態框中的預設狀態是「上架中」，但表格預設值是「未上架」，這導致了混亂

## 修復過程

### 第一階段修復

修改了 `TicketsPage.jsx` 文件的多個部分：

1. 改進了 `loadTickets` 函數中的數據處理，確保狀態值正確標準化
2. 修改了票券狀態顯示邏輯，簡化條件判斷
3. 在 `handleSaveTicket` 函數中添加了本地狀態更新，不僅依賴API重新加載
4. 在 `handleEditTicket` 函數中添加了狀態值標準化

### 第二階段修復

解決了預設值不一致問題：

1. 將所有新增票券時的預設狀態從 `active` 調整為 `inactive`
2. 確保模態框中的預設值與表格初始顯示保持一致
3. 修改了3處涉及預設狀態的代碼位置

## 測試與確認

修復後，票券狀態可以正確顯示和更新：
- 新增票券時，預設狀態是「未上架」
- 編輯票券並更改狀態時，表格會即時反映更新
- 所有狀態值處理邏輯統一且一致

## 技術細節

### 主要修改文件
- `/Users/alanp/digital-concert-hall/frontend-admin/src/pages/TicketsPage.jsx`

### 關鍵修改點
1. 標準化狀態處理:
```javascript
// 標準化狀態值，確保使用明確的 'active' 或 'inactive'
const status = ticket.status === 'active' ? 'active' : 'inactive';
```

2. 即時更新本地狀態:
```javascript
// 更新本地状态，避免等待後端同步
const updatedTickets = tickets.map(ticket => 
  ticket.id === ticketData.id ? { ...ticket, ...ticketData } : ticket
);
setTickets(updatedTickets);
```

3. 統一預設值:
```javascript
status: 'inactive'  // 預設為「未上架」狀態，與表格初始狀態保持一致
```

## 結論

這個問題主要源於系統內部狀態值處理不一致和預設值設定不一致。通過統一狀態處理邏輯，特別是統一初始預設值，成功解決了票券狀態顯示問題。用戶現在可以正確編輯和顯示票券狀態，無需重複操作。